---
layout: post
categories: work
title: '前端为什么会有service层'
date: 2019-03-09
---

## 疑问？
今天再cnode社区看到了一个问题
>
   用户——>Client(浏览器)——>service(用来请求后端的数据)——>backend，其中client和service是一体的。遇到一个问题，backend的数据返回给了service，service把数据返回给client，由于client的网速很慢，导致用户看到了client报出的超时错误。
   * 为什么需要service层（我们老大解释说，为了统一。还能避免跨域请求的问题）；
   * client和service的代码是一体的，一个服务，它的代码怎么知道哪些是在浏览器执行，哪些是在node执行呢？

## 解答
有不好老哥给出了回复
比如说BFF粘合层的出现等
看到了一个很好的回答特此记录一下

>首先要明确一点是：一千个系统有一千种架构，都是因地制宜的。并不是说有一个万能架构可以套用在所有系统上，选择最适合的架构设计来解决实际问题才是合理的。
前端和后端、客户端与服务端，他们都是彼此相对存在的，一个名字在不同的环境下可能代表不同的东西。比如对于广义上的服务端来说，可以采用MVC思想来设计，那么View其实是可以看做是服务端的前端的；再看广义上的客户端，比如用Angular开发的网站，HTML模板部分可以看做是前端，而数据处理和HTTP通信的部分可以看做是后端；又看通常的微服务的设计上，提供接口的可以称为服务端，调用接口的不管他是一个APP、网页还是另一个微服务，我们也都可以在这种语境下称它为客户端。
楼主描述的应该就是在网站客户端系统内的语境下，页面样式部分是“client”，数据处理与HTTP请求的部分是“service”，这只是抽象概念上的名称而已，实际上所有代码都是在浏览器上执行的，没有在node上执行的，并不是说提到“service”就一定指的是广义上在服务器上跑的哪种Web服务。
拥有多个客户端产品的企业，可能会在不同客户端上应用不同的中间件，比如不同的认证策略，但是同一个核心功能又可能需要同时提供给多个客户端，那么传统的做法是在服务端上给每一个客户端写一个单独的接口，这样在小规模项目上是合理的，但是项目规模大了之后，特别是不同客户端由不同团队运营的情况下，服务端接口的复杂度会变得非常高，解决这种复杂度的一种思路就是讲不同的部分移交给各端团队自行处理，服务端只提供公共业务，而移出来的部分又往往不适合在客户端直接做，还是需要在服务器上做，那么API Gateway的概念就出来了。
每个客户端都可以设立一个自己的API Gateway，上面可以挂载这个客户端的业务需要用到的中间件，比如身份认证，后面是直接映射到通用服务端的接口，适用于简单的业务拆分场景。
如果业务拆分场景比较复杂，比如客户端希望一个页面上的数据用一个接口就全拿到，但这些数据可能在不同的服务端系统上，这时候就可以采用BFF的思想，专门为这个客户端做一个后端，后端把底层多个服务端的接口数据聚合成一个接口提供给客户端。
以上都是在有实际需求的情况下选用合适的架构思想，并不是说最好所有项目都要有Service层，对于某些企业的业务场景来说，业务可能主要在客户端上，比如游戏、工具型应用等，对于他们来说其实是不需要有一个真正意义上的服务端的，往往只是需要一个云端的存储空间而已。

自己稍微总结下就是：
BFF层是随着客户端类型的增加不断演化而来的
可能原来只提供PC或者web然后又增加了移动端等等，这些不同的客户端其实现实中需要的是不同的接口，或者说接口会有差异。如果在每个服务器上都提供那会是个灾难的选择。
而如果服务器提供只提供核心的服务，这些差异化的东西抽离出一个层面来处理就方便很多
无论是叫service还是gate其实都是为了实现这个目的而已
